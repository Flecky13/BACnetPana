
        private void UpdateBACnetServicesAnalysis(List<NetworkPacket> filteredPackets)
        {
            // Erkenne BACnet-Pakete (ApplicationProtocol == "BACnet" oder Port 47808-47823)
            var bacnetPackets = filteredPackets.Where(p =>
                (p.ApplicationProtocol?.ToUpper() == "BACNET") ||
                (p.DestinationPort >= 47808 && p.DestinationPort <= 47823) ||
                (p.SourcePort >= 47808 && p.SourcePort <= 47823)).ToList();

            if (bacnetPackets.Count == 0)
            {
                // Keine BACnet-Pakete -> Bereich ausblenden
                if (BACnetServicesAnalysisBorder != null)
                    BACnetServicesAnalysisBorder.Visibility = Visibility.Collapsed;
                return;
            }

            // BACnet-Pakete vorhanden -> Bereich anzeigen
            if (BACnetServicesAnalysisBorder != null)
                BACnetServicesAnalysisBorder.Visibility = Visibility.Visible;

            // ZÃ¤hle Metriken aus Details dictionary
            var readWriteCount = 0;
            var confirmedServCount = 0;
            var fastResponseCount = 0;
            var errorCount = 0;

            foreach (var packet in bacnetPackets)
            {
                if (packet.Details != null)
                {
                    foreach (var detail in packet.Details)
                    {
                        var key = detail.Key?.ToLower() ?? "";
                        var value = detail.Value?.ToLower() ?? "";

                        // bacnet.service == 8 (ReadProperty) || bacnet.service == 0 (WriteProperty)
                        if ((key.Contains("service") && (value.Contains("8") || value.Contains("0"))) ||
                            key.Contains("readproperty") || key.Contains("writeproperty"))
                            readWriteCount++;

                        // bacnet.confirmed_service
                        if (key.Contains("confirmed") && key.Contains("service"))
                            confirmedServCount++;

                        // bacnet.confirmed_service && frame.time_delta < 0.2 (schnelle Response)
                        if ((key.Contains("confirmed") && key.Contains("service")) &&
                            (key.Contains("time_delta") && value.Contains(".") && double.TryParse(value, out var delta) && delta < 0.2))
                            fastResponseCount++;

                        // bacnet.reject || bacnet.abort || bacnet.error
                        if (key.Contains("reject") || key.Contains("abort") || key.Contains("error"))
                            errorCount++;
                    }
                }
            }

            // Update Labels
            if (BACnetReadWriteLabel != null)
                BACnetReadWriteLabel.Text = readWriteCount.ToString();
            if (BACnetConfirmedServLabel != null)
                BACnetConfirmedServLabel.Text = confirmedServCount.ToString();
            if (BACnetFastResponseLabel != null)
                BACnetFastResponseLabel.Text = fastResponseCount.ToString();
            if (BACnetErrorsLabel != null)
                BACnetErrorsLabel.Text = errorCount.ToString();
        }
